# Oracle Cloud Infrastructure (OCI) WAF ハンズオン用攻撃スクリプト

## 注意
このスクリプトは、OCIのハンズオン用途にのみ使用できます。このスクリプトのご自身の管理下にないサイトへのアクセスには使用しないでください。
また、各パラメーターを無闇に増やしてアクセス回数を増やしたり、続けて何度も実行したりすると、たとえ意図していなくても、そのアクセスが攻撃であると認識され、アクセスが遮断されたりサービスを切断されるなどの。予期せぬ自体を巻き起こすことがありますので。注意してください。
このスクリプトを利用したことで不利益を被った場合にも作者はその責務は負いません。

## 使い方
### 前提条件
1. Webサーバー、OCI WAF、DNSが正しく構成され、正しくHTTPリクエストを返すこと
1. WAFポリシーで、全ての保護ルールが検知またはブロックに設定されていること、またBot管理のヒューマン・インタラクション・チャレンジの検出またはブロックが設定されていること
1. 攻撃スクリプトを実行するために、Bashが実行できるクライアントがあること
1. この攻撃スクリプトを実行するクライアントから、WAFに対して正しくアクセスできること(ファイアウォールでブロックされていないこと) ※社内環境などファイアウォール内部からの実行はうまくいかない場合があります
1. クライアントに Apache Benchmark がインストールされ、```ab``` コマンドにパスが通っていること

クライアントにはOCIコンソールのCloud Shellがお勧めです。Cloud Shellであれば、3~5は特に問題なく満たすことができます。

### インストールとセットアップ
このリポジトリをクローンします
https://github.com/mmarukaw/oci-waf-handson.git

oci-waf-handson/attack-scripts にある config をエディタで開き、パラメーターを編集します。

```
# WAF secured host
# 講師の指示に従って、ホスト名を変更してください。
WAFSecuredHost=<WAFでブロックされたホストのFQDN>

# Path for vulnerability test
VulnerabilityPath=<スクリプトがアクセスするURIパス>

# Language
Language=<スクリプトのガイドの言語 JA/EN>
```

### スクリプトの実行
この攻撃スクリプトには、6個のシナリオが用意されています。それぞれのシナリオが、attack-scripts 以下にある01から06で始まるシェルスクリプトファイルが対応しています。

#### シナリオ1~5 保護ルールの確認
シナリオ1から5までは、ルールベースのファイアウォールである、保護ルールの有効性を確認するためのものです。
それぞれのシナリオが、WAFの特定の保護ルールに抵触するようなロジックで、WAFの背後にあるWebサーバーへのアクセスを10回ずつ試みます。
WAFが正しく構成されていれば、WAFのフィルター機能が働き、ログに「検出」または「ブロック」で出力されます。(どちらが出力されるかは、WAFの設定によります)
もし「ブロック」に設定していた場合には、クライアントに返る応答は200 OKではなく、4xx番台などになります。(実際の
